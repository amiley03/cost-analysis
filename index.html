<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Costing Forecast</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            min-height: 100vh;
            color: #e0e0e0;
        }

        /* Login Screen */
        #login-screen {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
        }

        .login-box {
            background: rgba(255,255,255,0.05);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            padding: 40px;
            width: 100%;
            max-width: 400px;
            border: 1px solid rgba(255,255,255,0.1);
        }

        .login-box h1 {
            text-align: center;
            margin-bottom: 8px;
            color: #fff;
            font-size: 28px;
        }

        .login-box .subtitle {
            text-align: center;
            color: #888;
            margin-bottom: 30px;
            font-size: 14px;
        }

        .login-box input {
            width: 100%;
            padding: 14px 16px;
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 8px;
            background: rgba(255,255,255,0.05);
            color: #fff;
            font-size: 16px;
            margin-bottom: 16px;
        }

        .login-box input:focus {
            outline: none;
            border-color: #4a9eff;
        }

        .login-box button {
            width: 100%;
            padding: 14px;
            background: linear-gradient(135deg, #4a9eff 0%, #6366f1 100%);
            border: none;
            border-radius: 8px;
            color: #fff;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .login-box button:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(74, 158, 255, 0.3);
        }

        .login-error {
            color: #ff6b6b;
            text-align: center;
            margin-top: 12px;
            font-size: 14px;
            display: none;
        }

        /* Main App */
        #main-app {
            display: none;
            padding: 20px;
            max-width: 1400px;
            margin: 0 auto;
        }

        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        header h1 {
            font-size: 24px;
            color: #fff;
        }

        header button {
            padding: 8px 16px;
            background: rgba(255,255,255,0.1);
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 6px;
            color: #fff;
            cursor: pointer;
            font-size: 14px;
        }

        .tabs {
            display: flex;
            gap: 8px;
            margin-bottom: 24px;
        }

        .tab {
            padding: 12px 24px;
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 8px;
            color: #888;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.2s;
        }

        .tab.active {
            background: linear-gradient(135deg, #4a9eff 0%, #6366f1 100%);
            color: #fff;
            border-color: transparent;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .card {
            background: rgba(255,255,255,0.05);
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 24px;
            border: 1px solid rgba(255,255,255,0.1);
        }

        .card h2 {
            font-size: 18px;
            margin-bottom: 20px;
            color: #fff;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .card h2 .badge {
            font-size: 12px;
            padding: 4px 8px;
            background: rgba(74, 158, 255, 0.2);
            color: #4a9eff;
            border-radius: 4px;
            font-weight: 500;
        }

        .input-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
        }

        .input-group {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }

        .input-group label {
            font-size: 13px;
            color: #888;
        }

        .input-group input, .input-group select {
            padding: 10px 12px;
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 6px;
            background: rgba(255,255,255,0.05);
            color: #fff;
            font-size: 14px;
        }

        .input-group input:focus, .input-group select:focus {
            outline: none;
            border-color: #4a9eff;
        }

        .input-group input.editable {
            background: rgba(255, 193, 7, 0.1);
            border-color: rgba(255, 193, 7, 0.3);
        }

        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 16px;
        }

        .metric {
            background: rgba(255,255,255,0.03);
            padding: 16px;
            border-radius: 8px;
            border: 1px solid rgba(255,255,255,0.05);
        }

        .metric .label {
            font-size: 12px;
            color: #888;
            margin-bottom: 4px;
        }

        .metric .value {
            font-size: 24px;
            font-weight: 600;
            color: #fff;
        }

        .metric .value.positive {
            color: #22c55e;
        }

        .metric .value.negative {
            color: #ef4444;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 13px;
        }

        th, td {
            padding: 12px;
            text-align: right;
            border-bottom: 1px solid rgba(255,255,255,0.05);
        }

        th {
            color: #888;
            font-weight: 500;
            font-size: 12px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        th:first-child, td:first-child {
            text-align: left;
        }

        td.positive {
            color: #22c55e;
        }

        td.negative {
            color: #ef4444;
        }

        .month-toggle {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .month-toggle input[type="checkbox"] {
            width: 18px;
            height: 18px;
            cursor: pointer;
        }

        .table-container {
            overflow-x: auto;
        }

        /* Transfer Pricing Styles */
        .channel-card {
            background: rgba(255,255,255,0.03);
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 16px;
        }

        .channel-card h3 {
            font-size: 16px;
            margin-bottom: 16px;
            color: #fff;
        }

        .pricing-row {
            display: grid;
            grid-template-columns: 2fr 1fr 1fr 1fr 1fr;
            gap: 12px;
            padding: 8px 0;
            border-bottom: 1px solid rgba(255,255,255,0.05);
            align-items: center;
        }

        .pricing-row.header {
            font-size: 11px;
            color: #888;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            padding-bottom: 12px;
            margin-bottom: 8px;
        }

        .flag {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 11px;
            font-weight: 500;
        }

        .flag.ok {
            background: rgba(34, 197, 94, 0.2);
            color: #22c55e;
        }

        .flag.warning {
            background: rgba(251, 191, 36, 0.2);
            color: #fbbf24;
        }

        .flag.error {
            background: rgba(239, 68, 68, 0.2);
            color: #ef4444;
        }

        .legend {
            display: flex;
            gap: 20px;
            margin-top: 20px;
            padding-top: 16px;
            border-top: 1px solid rgba(255,255,255,0.1);
            font-size: 12px;
            color: #888;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .legend-color {
            width: 12px;
            height: 12px;
            border-radius: 3px;
        }

        .legend-color.yellow {
            background: rgba(255, 193, 7, 0.3);
            border: 1px solid rgba(255, 193, 7, 0.5);
        }

        .legend-color.green {
            background: rgba(34, 197, 94, 0.3);
            border: 1px solid rgba(34, 197, 94, 0.5);
        }

        @media (max-width: 768px) {
            .pricing-row {
                grid-template-columns: 1fr 1fr;
            }

            .pricing-row.header {
                display: none;
            }
        }

        /* Product Mix Table Styles */
        .mix-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 13px;
        }

        .mix-table th, .mix-table td {
            padding: 10px 12px;
            text-align: right;
            border-bottom: 1px solid rgba(255,255,255,0.05);
        }

        .mix-table th {
            color: #888;
            font-weight: 500;
            font-size: 11px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .mix-table th:first-child, .mix-table td:first-child {
            text-align: left;
        }

        .mix-table .mix-slider-container {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .mix-table input.mix-slider {
            width: 80px;
            height: 6px;
            -webkit-appearance: none;
            appearance: none;
            background: rgba(255,255,255,0.1);
            border-radius: 3px;
            cursor: pointer;
        }

        .mix-table input.mix-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background: linear-gradient(135deg, #4a9eff 0%, #6366f1 100%);
            cursor: pointer;
            border: 2px solid rgba(255,255,255,0.3);
            transition: transform 0.1s;
        }

        .mix-table input.mix-slider::-webkit-slider-thumb:hover {
            transform: scale(1.2);
        }

        .mix-table input.mix-slider::-moz-range-thumb {
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background: linear-gradient(135deg, #4a9eff 0%, #6366f1 100%);
            cursor: pointer;
            border: 2px solid rgba(255,255,255,0.3);
        }

        .mix-table .mix-value {
            min-width: 45px;
            text-align: right;
            font-size: 13px;
            color: #fff;
        }

        .mix-table tr.best-margin {
            background: rgba(34, 197, 94, 0.1);
        }

        .mix-table tr.best-margin td:first-child::after {
            content: ' ★';
            color: #22c55e;
        }

        .mix-validation {
            display: flex;
            align-items: center;
            gap: 16px;
            margin-bottom: 16px;
            padding: 12px 16px;
            background: rgba(255,255,255,0.03);
            border-radius: 8px;
        }

        .mix-total {
            font-size: 14px;
            font-weight: 500;
        }

        .mix-total.valid {
            color: #22c55e;
        }

        .mix-total.invalid {
            color: #fbbf24;
        }

        .normalize-btn {
            padding: 6px 12px;
            background: rgba(74, 158, 255, 0.2);
            border: 1px solid rgba(74, 158, 255, 0.3);
            border-radius: 4px;
            color: #4a9eff;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .normalize-btn:hover {
            background: rgba(74, 158, 255, 0.3);
        }

        .best-size-indicator {
            margin-left: auto;
            font-size: 13px;
            color: #22c55e;
        }

        /* Simplified monthly table */
        .monthly-simple th, .monthly-simple td {
            padding: 10px 12px;
        }

        /* Product Selector Styles */
        .product-selector {
            margin-bottom: 20px;
            padding: 16px;
            background: rgba(255,255,255,0.03);
            border-radius: 8px;
            border: 1px solid rgba(255,255,255,0.1);
        }

        .product-selector h4 {
            font-size: 13px;
            color: #888;
            margin-bottom: 12px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .flavor-group {
            margin-bottom: 12px;
        }

        .flavor-group-header {
            font-size: 12px;
            font-weight: 600;
            color: #4a9eff;
            margin-bottom: 6px;
        }

        .product-checkboxes {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        .product-checkbox {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 4px 10px;
            background: rgba(255,255,255,0.05);
            border-radius: 4px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .product-checkbox:hover {
            background: rgba(255,255,255,0.1);
        }

        .product-checkbox input {
            cursor: pointer;
        }

        .product-checkbox.selected {
            background: rgba(74, 158, 255, 0.2);
            border: 1px solid rgba(74, 158, 255, 0.3);
        }

        .select-actions {
            display: flex;
            gap: 8px;
            margin-top: 12px;
            padding-top: 12px;
            border-top: 1px solid rgba(255,255,255,0.1);
        }

        .select-btn {
            padding: 4px 10px;
            font-size: 11px;
            background: rgba(255,255,255,0.1);
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 4px;
            color: #888;
            cursor: pointer;
            transition: all 0.2s;
        }

        .select-btn:hover {
            background: rgba(255,255,255,0.15);
            color: #fff;
        }
    </style>
</head>
<body>
    <!-- Login Screen -->
    <div id="login-screen">
        <div class="login-box">
            <h1>Costing Forecast</h1>
            <p class="subtitle">Product Margin Analysis</p>
            <input type="password" id="password" placeholder="Enter password" onkeypress="if(event.key === 'Enter') login()">
            <button onclick="login()">Access Dashboard</button>
            <p class="login-error" id="login-error">Incorrect password. Please try again.</p>
        </div>
    </div>

    <!-- Main Application -->
    <div id="main-app">
        <header>
            <h1>Costing Forecast Dashboard</h1>
            <button onclick="logout()">Logout</button>
        </header>

        <div class="tabs">
            <div class="tab active" onclick="switchTab('scenario')">Scenario Planner</div>
            <div class="tab" onclick="switchTab('pricing')">Transfer & Retail Pricing</div>
        </div>

        <!-- Scenario Planner Tab -->
        <div id="scenario-tab" class="tab-content active">
            <div class="card">
                <h2>Scenario Inputs <span class="badge">Editable</span></h2>
                <div class="input-grid">
                    <div class="input-group">
                        <label>Annual Lbs (Scenario)</label>
                        <input type="number" id="annualLbs" class="editable" value="638205" onchange="recalculate()">
                    </div>
                    <div class="input-group">
                        <label>Labor Fixed %</label>
                        <input type="number" id="laborFixed" class="editable" value="30" min="0" max="100" onchange="recalculate()">
                    </div>
                    <div class="input-group">
                        <label>Overhead Fixed %</label>
                        <input type="number" id="overheadFixed" class="editable" value="30" min="0" max="100" onchange="recalculate()">
                    </div>
                    <div class="input-group">
                        <label>Freight Fixed %</label>
                        <input type="number" id="freightFixed" class="editable" value="0" min="0" max="100" onchange="recalculate()">
                    </div>
                    <div class="input-group">
                        <label>Target GM % (optional)</label>
                        <input type="number" id="targetGM" class="editable" value="0" min="0" max="100" onchange="recalculate()">
                    </div>
                </div>
            </div>

            <div class="card">
                <h2>Annual Summary</h2>
                <div class="metrics-grid">
                    <div class="metric">
                        <div class="label">Annual Revenue</div>
                        <div class="value" id="totalRevenue">$0</div>
                    </div>
                    <div class="metric">
                        <div class="label">Annual Total Cost</div>
                        <div class="value" id="totalCost">$0</div>
                    </div>
                    <div class="metric">
                        <div class="label">Annual Gross Margin</div>
                        <div class="value" id="totalGM">$0</div>
                    </div>
                    <div class="metric">
                        <div class="label">GM %</div>
                        <div class="value" id="gmPercent">0%</div>
                    </div>
                    <div class="metric">
                        <div class="label">Best Margin Size</div>
                        <div class="value" id="bestSizeDisplay">-</div>
                    </div>
                    <div class="metric">
                        <div class="label">Meets Target GM?</div>
                        <div class="value" id="meetsTarget">-</div>
                    </div>
                </div>
            </div>

            <div class="card">
                <h2>Product Mix <span class="badge">Editable</span></h2>
                <p style="font-size: 13px; color: #888; margin-bottom: 16px;">Adjust the mix percentage for each product size to see the impact on margins. Best margin size is highlighted with a star.</p>
                <div class="mix-validation">
                    <span class="mix-total" id="mixTotal">Total Mix: 100%</span>
                    <button class="normalize-btn" onclick="normalizeMix()">Auto-Normalize to 100%</button>
                    <span class="best-size-indicator" id="bestSizeIndicator">Best Size: --</span>
                </div>
                <div class="table-container">
                    <table class="mix-table">
                        <thead>
                            <tr>
                                <th>Size (oz)</th>
                                <th>Mix %</th>
                                <th>Revenue/lb</th>
                                <th>Cost/lb</th>
                                <th>Margin/lb</th>
                                <th>Margin %</th>
                            </tr>
                        </thead>
                        <tbody id="mixTable">
                            <!-- Populated by JS -->
                        </tbody>
                    </table>
                </div>
            </div>

            <div class="card">
                <h2>Monthly Breakdown</h2>
                <div class="table-container">
                    <table class="monthly-simple">
                        <thead>
                            <tr>
                                <th>Month</th>
                                <th>Total Lbs</th>
                                <th>Revenue</th>
                                <th>Total Cost</th>
                                <th>Gross Margin</th>
                                <th>GM %</th>
                            </tr>
                        </thead>
                        <tbody id="monthlyTable">
                            <!-- Populated by JS -->
                        </tbody>
                        <tfoot id="monthlyTotals">
                            <!-- Populated by JS -->
                        </tfoot>
                    </table>
                </div>
            </div>

            <div class="card">
                <h2>Cost Scaling Summary <span class="badge">Weighted Avg Per Unit</span></h2>
                <div class="metrics-grid">
                    <div class="metric">
                        <div class="label">Labor $/unit</div>
                        <div class="value" id="laborPerUnit">$0.00</div>
                    </div>
                    <div class="metric">
                        <div class="label">Overhead $/unit</div>
                        <div class="value" id="overheadPerUnit">$0.00</div>
                    </div>
                    <div class="metric">
                        <div class="label">Freight $/unit</div>
                        <div class="value" id="freightPerUnit">$0.00</div>
                    </div>
                    <div class="metric">
                        <div class="label">Avg Unit Size</div>
                        <div class="value" id="avgUnitSize">0 oz</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Transfer Pricing Tab -->
        <div id="pricing-tab" class="tab-content">
            <div class="card">
                <h2>Channel Assumptions <span class="badge">Editable</span></h2>
                <div class="input-grid">
                    <div class="input-group">
                        <label>Safeway Retail GM %</label>
                        <input type="number" id="safewayGM" class="editable" value="30" min="0" max="100" onchange="recalculatePricing()">
                    </div>
                    <div class="input-group">
                        <label>CVS Retail GM %</label>
                        <input type="number" id="cvsGM" class="editable" value="35" min="0" max="100" onchange="recalculatePricing()">
                    </div>
                    <div class="input-group">
                        <label>Distributor GM %</label>
                        <input type="number" id="distributorGM" class="editable" value="25" min="0" max="100" onchange="recalculatePricing()">
                    </div>
                    <div class="input-group">
                        <label>Manufacturer Target GM %</label>
                        <input type="number" id="mfgTargetGM" class="editable" value="30" min="0" max="100" onchange="recalculatePricing()">
                    </div>
                    <div class="input-group">
                        <label>Costco Markup %</label>
                        <input type="number" id="costcoMarkup" class="editable" value="14" min="0" max="100" onchange="recalculatePricing()">
                    </div>
                </div>
                <div class="input-grid" style="margin-top: 16px;">
                    <div class="input-group">
                        <label>Safeway $/oz Target</label>
                        <input type="number" id="safewayPerOz" class="editable" value="2.80" step="0.01" onchange="recalculatePricing()">
                    </div>
                    <div class="input-group">
                        <label>CVS $/oz Target</label>
                        <input type="number" id="cvsPerOz" class="editable" value="3.00" step="0.01" onchange="recalculatePricing()">
                    </div>
                    <div class="input-group">
                        <label>Costco $/oz Target</label>
                        <input type="number" id="costcoPerOz" class="editable" value="1.05" step="0.01" onchange="recalculatePricing()">
                    </div>
                </div>
            </div>

            <!-- Costco Pricing -->
            <div class="card">
                <h2>Costco (Direct)</h2>
                <div class="product-selector" id="costco-selector">
                    <h4>Select Products for Costco</h4>
                    <div id="costco-checkboxes">
                        <!-- Populated by JS -->
                    </div>
                    <div class="select-actions">
                        <button class="select-btn" onclick="selectAllChannel('costco')">Select All</button>
                        <button class="select-btn" onclick="clearAllChannel('costco')">Clear All</button>
                        <button class="select-btn" onclick="selectBySize('costco', 14)">14oz Only</button>
                    </div>
                </div>
                <div class="channel-card">
                    <div class="pricing-row header">
                        <div>Product</div>
                        <div>COGS/Unit</div>
                        <div>Target SRP</div>
                        <div>Suggested Transfer</div>
                        <div>Status</div>
                    </div>
                    <div id="costco-products">
                        <!-- Populated by JS -->
                    </div>
                </div>
            </div>

            <!-- Safeway Pricing -->
            <div class="card">
                <h2>Safeway (via Distributor)</h2>
                <div class="product-selector" id="safeway-selector">
                    <h4>Select Products for Safeway</h4>
                    <div id="safeway-checkboxes">
                        <!-- Populated by JS -->
                    </div>
                    <div class="select-actions">
                        <button class="select-btn" onclick="selectAllChannel('safeway')">Select All</button>
                        <button class="select-btn" onclick="clearAllChannel('safeway')">Clear All</button>
                        <button class="select-btn" onclick="selectBySize('safeway', 2.5)">2.5oz Only</button>
                        <button class="select-btn" onclick="selectBySize('safeway', 6)">6oz Only</button>
                    </div>
                </div>
                <div class="channel-card">
                    <div class="pricing-row header">
                        <div>Product</div>
                        <div>COGS/Unit</div>
                        <div>Target SRP</div>
                        <div>Suggested Transfer</div>
                        <div>Status</div>
                    </div>
                    <div id="safeway-products">
                        <!-- Populated by JS -->
                    </div>
                </div>
            </div>

            <!-- CVS Pricing -->
            <div class="card">
                <h2>CVS (via Distributor)</h2>
                <div class="product-selector" id="cvs-selector">
                    <h4>Select Products for CVS</h4>
                    <div id="cvs-checkboxes">
                        <!-- Populated by JS -->
                    </div>
                    <div class="select-actions">
                        <button class="select-btn" onclick="selectAllChannel('cvs')">Select All</button>
                        <button class="select-btn" onclick="clearAllChannel('cvs')">Clear All</button>
                        <button class="select-btn" onclick="selectBySize('cvs', 2.5)">2.5oz Only</button>
                    </div>
                </div>
                <div class="channel-card">
                    <div class="pricing-row header">
                        <div>Product</div>
                        <div>COGS/Unit</div>
                        <div>Target SRP</div>
                        <div>Suggested Transfer</div>
                        <div>Status</div>
                    </div>
                    <div id="cvs-products">
                        <!-- Populated by JS -->
                    </div>
                </div>
            </div>

            <div class="card">
                <h2>Pricing Formula Reference</h2>
                <p style="font-size: 13px; color: #888; line-height: 1.8;">
                    <strong>Safeway/CVS (through distributor):</strong><br>
                    Retail Cost = SRP × (1 – Retail GM%)<br>
                    Max Mfg→Dist Transfer = Retail Cost × (1 – Distributor GM%)<br><br>
                    <strong>Costco (direct):</strong><br>
                    Max Mfg Price = SRP ÷ (1 + Costco Markup%)
                </p>
                <div class="legend">
                    <div class="legend-item">
                        <div class="legend-color yellow"></div>
                        <span>Editable inputs</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color green"></div>
                        <span>Suggested transfer prices</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Configuration - CHANGE THIS PASSWORD
        const SITE_PASSWORD = 'bearbear2026';

        // Baseline data from spreadsheet (2025 Costing Summary_3.xlsx, $ Per Unit 7yr sheet, 1 Yr Proj column)
        const BASELINE = {
            lbs: 638204.76,
            laborAnnual: 865649,      // Total Labor 1 Yr Proj
            overheadAnnual: 1428705,  // Other Costs 1 Yr Proj
            freightAnnual: 158199     // Freight 1 Yr Proj
        };

        // Product sizes with their data - mixPct values are now editable via UI
        // Default mix percentages (converted to 0-100 scale for display)
        const PRODUCTS = [
            { size: 1, defaultMixPct: 0.1, transfer: 0.99, nonLOF: 0.56 },
            { size: 1.5, defaultMixPct: 0.1, transfer: 1.48, nonLOF: 0.84 },
            { size: 2, defaultMixPct: 0.2, transfer: 1.98, nonLOF: 1.11 },
            { size: 2.5, defaultMixPct: 15, transfer: 2.75, nonLOF: 1.49 },
            { size: 2.75, defaultMixPct: 0.1, transfer: 2.72, nonLOF: 1.53 },
            { size: 2.85, defaultMixPct: 0.1, transfer: 2.81, nonLOF: 1.59 },
            { size: 5, defaultMixPct: 0.1, transfer: 4.94, nonLOF: 2.79 },
            { size: 6, defaultMixPct: 25, transfer: 5.25, nonLOF: 3.11 },
            { size: 8, defaultMixPct: 5, transfer: 6.14, nonLOF: 4.17 },
            { size: 9, defaultMixPct: 0.1, transfer: 6.91, nonLOF: 4.69 },
            { size: 12, defaultMixPct: 20, transfer: 9.00, nonLOF: 6.64 },
            { size: 14, defaultMixPct: 30, transfer: 11.00, nonLOF: 6.85 },
            { size: 16, defaultMixPct: 4, transfer: 12.29, nonLOF: 8.34 }
        ];

        // Current mix percentages (editable, stored as 0-100 values)
        let currentMix = PRODUCTS.map(p => p.defaultMixPct);

        // Products for transfer pricing (COGS from 2025 Costing Summary_3.xlsx Combined sheet)
        const PRICING_PRODUCTS = [
            // Original Beef
            { id: 'ob-2.5', name: 'Original Beef 2.5oz Bag', flavor: 'Original Beef', size: 2.5, type: 'Bag', cogs: 5.08 },
            { id: 'ob-6', name: 'Original Beef 6oz Bag', flavor: 'Original Beef', size: 6, type: 'Bag', cogs: 6.70 },
            { id: 'ob-12', name: 'Original Beef 12oz Bag', flavor: 'Original Beef', size: 12, type: 'Bag', cogs: 10.22 },
            { id: 'ob-14', name: 'Original Beef 14oz Bag', flavor: 'Original Beef', size: 14, type: 'Bag', cogs: 10.43 },
            { id: 'ob-14t', name: 'Original Beef 14oz Tray', flavor: 'Original Beef', size: 14, type: 'Tray', cogs: 10.64 },
            // Sweet Beef
            { id: 'sb-2.5', name: 'Sweet Beef 2.5oz Bag', flavor: 'Sweet Beef', size: 2.5, type: 'Bag', cogs: 5.03 },
            { id: 'sb-6', name: 'Sweet Beef 6oz Bag', flavor: 'Sweet Beef', size: 6, type: 'Bag', cogs: 8.36 },
            { id: 'sb-8', name: 'Sweet Beef 8oz Bag', flavor: 'Sweet Beef', size: 8, type: 'Bag', cogs: 7.56 },
            { id: 'sb-12', name: 'Sweet Beef 12oz Bag', flavor: 'Sweet Beef', size: 12, type: 'Bag', cogs: 10.03 },
            { id: 'sb-14', name: 'Sweet Beef 14oz Bag', flavor: 'Sweet Beef', size: 14, type: 'Bag', cogs: 10.11 },
            { id: 'sb-14t', name: 'Sweet Beef 14oz Tray', flavor: 'Sweet Beef', size: 14, type: 'Tray', cogs: 10.31 },
            // Spicy Beef
            { id: 'spb-2.5', name: 'Spicy Beef 2.5oz Bag', flavor: 'Spicy Beef', size: 2.5, type: 'Bag', cogs: 5.08 },
            { id: 'spb-6', name: 'Spicy Beef 6oz Bag', flavor: 'Spicy Beef', size: 6, type: 'Bag', cogs: 6.70 },
            { id: 'spb-12', name: 'Spicy Beef 12oz Bag', flavor: 'Spicy Beef', size: 12, type: 'Bag', cogs: 10.03 },
            { id: 'spb-14', name: 'Spicy Beef 14oz Bag', flavor: 'Spicy Beef', size: 14, type: 'Bag', cogs: 10.36 },
            { id: 'spb-14t', name: 'Spicy Beef 14oz Tray', flavor: 'Spicy Beef', size: 14, type: 'Tray', cogs: 10.56 },
            // Sweet+Spicy Beef
            { id: 'ssb-2.5', name: 'Sweet+Spicy Beef 2.5oz Bag', flavor: 'Sweet+Spicy Beef', size: 2.5, type: 'Bag', cogs: 5.05 },
            { id: 'ssb-6', name: 'Sweet+Spicy Beef 6oz Bag', flavor: 'Sweet+Spicy Beef', size: 6, type: 'Bag', cogs: 6.58 },
            { id: 'ssb-12', name: 'Sweet+Spicy Beef 12oz Bag', flavor: 'Sweet+Spicy Beef', size: 12, type: 'Bag', cogs: 10.03 },
            { id: 'ssb-14', name: 'Sweet+Spicy Beef 14oz Bag', flavor: 'Sweet+Spicy Beef', size: 14, type: 'Bag', cogs: 10.11 },
            { id: 'ssb-14t', name: 'Sweet+Spicy Beef 14oz Tray', flavor: 'Sweet+Spicy Beef', size: 14, type: 'Tray', cogs: 10.31 },
            // Grilled Pork / Island
            { id: 'gp-2.5', name: 'Grilled Pork 2.5oz Bag', flavor: 'Grilled Pork', size: 2.5, type: 'Bag', cogs: 4.64 },
            { id: 'gp-6', name: 'Grilled Pork 6oz Bag', flavor: 'Grilled Pork', size: 6, type: 'Bag', cogs: 5.24 },
            { id: 'gp-12', name: 'Grilled Pork 12oz Bag', flavor: 'Grilled Pork', size: 12, type: 'Bag', cogs: 7.25 },
            { id: 'gp-14', name: 'Grilled Pork 14oz Bag', flavor: 'Grilled Pork', size: 14, type: 'Bag', cogs: 6.95 },
            { id: 'gp-14t', name: 'Grilled Pork 14oz Tray', flavor: 'Grilled Pork', size: 14, type: 'Tray', cogs: 7.15 },
            // Grilled Spicy Pork
            { id: 'gsp-2.5', name: 'Grilled Spicy Pork 2.5oz Bag', flavor: 'Grilled Spicy Pork', size: 2.5, type: 'Bag', cogs: 4.50 },
            { id: 'gsp-6', name: 'Grilled Spicy Pork 6oz Bag', flavor: 'Grilled Spicy Pork', size: 6, type: 'Bag', cogs: 5.28 },
            { id: 'gsp-14', name: 'Grilled Spicy Pork 14oz Bag', flavor: 'Grilled Spicy Pork', size: 14, type: 'Bag', cogs: 6.98 },
            { id: 'gsp-14t', name: 'Grilled Spicy Pork 14oz Tray', flavor: 'Grilled Spicy Pork', size: 14, type: 'Tray', cogs: 7.19 },
            // Grilled Beef
            { id: 'gb-2.5', name: 'Grilled Beef 2.5oz Bag', flavor: 'Grilled Beef', size: 2.5, type: 'Bag', cogs: 5.03 },
            { id: 'gb-2.85', name: 'Grilled Beef 2.85oz Bag', flavor: 'Grilled Beef', size: 2.85, type: 'Bag', cogs: 5.19 }
        ];

        // Channel product selections (which products are enabled for each retailer)
        const channelSelections = {
            costco: new Set(['ob-14', 'ob-14t', 'sb-14', 'sb-14t']),  // Default: 14oz products for Costco
            safeway: new Set(['ob-2.5', 'ob-6', 'sb-2.5', 'sb-6']),   // Default: smaller sizes for grocery
            cvs: new Set(['ob-2.5', 'sb-2.5', 'gb-2.5'])              // Default: 2.5oz for convenience
        };

        // Months with default 14oz multipliers
        const MONTHS = [
            { name: 'Jan', seasonality: 1/12, mult14: false },
            { name: 'Feb', seasonality: 1/12, mult14: false },
            { name: 'Mar', seasonality: 1/12, mult14: false },
            { name: 'Apr', seasonality: 1/12, mult14: false },
            { name: 'May', seasonality: 1/12, mult14: false },
            { name: 'Jun', seasonality: 1/12, mult14: false },
            { name: 'Jul', seasonality: 1/12, mult14: true },
            { name: 'Aug', seasonality: 1/12, mult14: true },
            { name: 'Sep', seasonality: 1/12, mult14: false },
            { name: 'Oct', seasonality: 1/12, mult14: true },
            { name: 'Nov', seasonality: 1/12, mult14: true },
            { name: 'Dec', seasonality: 1/12, mult14: true }
        ];

        // Login functions
        function login() {
            const pwd = document.getElementById('password').value;
            if (pwd === SITE_PASSWORD) {
                document.getElementById('login-screen').style.display = 'none';
                document.getElementById('main-app').style.display = 'block';
                sessionStorage.setItem('authenticated', 'true');
                recalculate();
                initProductSelectors();
                recalculatePricing();
            } else {
                document.getElementById('login-error').style.display = 'block';
            }
        }

        function logout() {
            sessionStorage.removeItem('authenticated');
            document.getElementById('login-screen').style.display = 'flex';
            document.getElementById('main-app').style.display = 'none';
            document.getElementById('password').value = '';
            document.getElementById('login-error').style.display = 'none';
        }

        function checkAuth() {
            if (sessionStorage.getItem('authenticated') === 'true') {
                document.getElementById('login-screen').style.display = 'none';
                document.getElementById('main-app').style.display = 'block';
                recalculate();
                initProductSelectors();
                recalculatePricing();
            }
        }

        // Tab switching
        function switchTab(tab) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));

            if (tab === 'scenario') {
                document.querySelector('.tabs .tab:first-child').classList.add('active');
                document.getElementById('scenario-tab').classList.add('active');
            } else {
                document.querySelector('.tabs .tab:last-child').classList.add('active');
                document.getElementById('pricing-tab').classList.add('active');
            }
        }

        // Format currency
        function formatCurrency(value) {
            return '$' + value.toLocaleString('en-US', { minimumFractionDigits: 0, maximumFractionDigits: 0 });
        }

        function formatCurrencyDecimal(value) {
            return '$' + value.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
        }

        function formatPercent(value) {
            return (value * 100).toFixed(1) + '%';
        }

        // Get current mix percentages from inputs
        function getMixFromInputs() {
            const inputs = document.querySelectorAll('.mix-input');
            if (inputs.length === 0) return currentMix;
            return Array.from(inputs).map(input => parseFloat(input.value) || 0);
        }

        // Update mix validation display
        function updateMixValidation() {
            const mix = getMixFromInputs();
            const total = mix.reduce((sum, val) => sum + val, 0);
            const totalEl = document.getElementById('mixTotal');

            totalEl.textContent = `Total Mix: ${total.toFixed(1)}%`;
            totalEl.className = 'mix-total ' + (Math.abs(total - 100) < 0.1 ? 'valid' : 'invalid');
        }

        // Normalize mix percentages to 100%
        function normalizeMix() {
            const mix = getMixFromInputs();
            const total = mix.reduce((sum, val) => sum + val, 0);

            if (total === 0) return;

            const normalized = mix.map(val => (val / total) * 100);
            currentMix = normalized;

            // Update inputs
            const inputs = document.querySelectorAll('.mix-input');
            inputs.forEach((input, i) => {
                input.value = normalized[i].toFixed(1);
            });

            updateMixValidation();
            recalculate();
        }

        // Handle mix input change
        function onMixChange(index, value) {
            currentMix[index] = parseFloat(value) || 0;
            updateMixValidation();
            recalculate();
        }

        // Calculate per-size metrics
        function calculateSizeMetrics(laborPerLb, overheadPerLb, freightPerLb) {
            return PRODUCTS.map((p, i) => {
                const lbPerUnit = p.size / 16;
                const revenuePerUnit = p.transfer;
                const nonLOFPerUnit = p.nonLOF;

                // Revenue per lb = transfer price / (oz/16)
                const revenuePerLb = revenuePerUnit / lbPerUnit;

                // Cost per lb = (nonLOF/unit) / (oz/16) + labor + overhead + freight
                const nonLOFPerLb = nonLOFPerUnit / lbPerUnit;
                const costPerLb = nonLOFPerLb + laborPerLb + overheadPerLb + freightPerLb;

                // Margin per lb
                const marginPerLb = revenuePerLb - costPerLb;

                // Margin %
                const marginPct = revenuePerLb > 0 ? marginPerLb / revenuePerLb : 0;

                return {
                    size: p.size,
                    mixPct: currentMix[i],
                    revenuePerLb,
                    costPerLb,
                    marginPerLb,
                    marginPct
                };
            });
        }

        // Render product mix table
        function renderMixTable(sizeMetrics) {
            const tbody = document.getElementById('mixTable');

            // Find best margin size (among sizes with non-zero mix)
            let bestMarginSize = null;
            let bestMarginValue = -Infinity;
            sizeMetrics.forEach(m => {
                if (m.mixPct > 0 && m.marginPerLb > bestMarginValue) {
                    bestMarginValue = m.marginPerLb;
                    bestMarginSize = m.size;
                }
            });

            // Update best size indicator
            const bestIndicator = document.getElementById('bestSizeIndicator');
            if (bestMarginSize !== null) {
                bestIndicator.textContent = `Best Size: ${bestMarginSize}oz ($${bestMarginValue.toFixed(2)}/lb margin)`;
            } else {
                bestIndicator.textContent = 'Best Size: --';
            }

            tbody.innerHTML = sizeMetrics.map((m, i) => `
                <tr class="${m.size === bestMarginSize ? 'best-margin' : ''}">
                    <td>${m.size}oz</td>
                    <td>
                        <div class="mix-slider-container">
                            <input type="range" class="mix-slider" value="${m.mixPct}"
                                   min="0" max="50" step="0.5"
                                   oninput="onMixChange(${i}, this.value)">
                            <span class="mix-value">${m.mixPct.toFixed(1)}%</span>
                        </div>
                    </td>
                    <td>${formatCurrencyDecimal(m.revenuePerLb)}</td>
                    <td>${formatCurrencyDecimal(m.costPerLb)}</td>
                    <td class="${m.marginPerLb >= 0 ? 'positive' : 'negative'}">${formatCurrencyDecimal(m.marginPerLb)}</td>
                    <td class="${m.marginPct >= 0.2 ? 'positive' : ''}">${formatPercent(m.marginPct)}</td>
                </tr>
            `).join('');
        }

        // Main calculation
        function recalculate() {
            const annualLbs = parseFloat(document.getElementById('annualLbs').value) || 0;
            const laborFixed = parseFloat(document.getElementById('laborFixed').value) / 100 || 0;
            const overheadFixed = parseFloat(document.getElementById('overheadFixed').value) / 100 || 0;
            const freightFixed = parseFloat(document.getElementById('freightFixed').value) / 100 || 0;
            const targetGM = parseFloat(document.getElementById('targetGM').value) / 100 || 0;

            // Calculate scaled costs
            const scenarioLabor = (BASELINE.laborAnnual * laborFixed) +
                ((BASELINE.laborAnnual * (1 - laborFixed)) / BASELINE.lbs) * annualLbs;
            const scenarioOverhead = (BASELINE.overheadAnnual * overheadFixed) +
                ((BASELINE.overheadAnnual * (1 - overheadFixed)) / BASELINE.lbs) * annualLbs;
            const scenarioFreight = (BASELINE.freightAnnual * freightFixed) +
                ((BASELINE.freightAnnual * (1 - freightFixed)) / BASELINE.lbs) * annualLbs;

            const laborPerLb = annualLbs > 0 ? scenarioLabor / annualLbs : 0;
            const overheadPerLb = annualLbs > 0 ? scenarioOverhead / annualLbs : 0;
            const freightPerLb = annualLbs > 0 ? scenarioFreight / annualLbs : 0;

            // Get current mix from inputs (as decimal fractions)
            const mix = getMixFromInputs();
            const mixFractions = mix.map(m => m / 100);

            // Calculate weighted average unit size based on product mix
            let mixDenomForAvg = mixFractions.reduce((sum, m) => sum + m, 0);
            if (mixDenomForAvg === 0) mixDenomForAvg = 1;

            let weightedSizeSum = 0;
            PRODUCTS.forEach((p, idx) => {
                weightedSizeSum += p.size * (mixFractions[idx] / mixDenomForAvg);
            });
            const avgUnitSize = weightedSizeSum; // in oz
            const avgLbsPerUnit = avgUnitSize / 16;

            // Calculate per-unit costs (weighted average)
            const laborPerUnit = laborPerLb * avgLbsPerUnit;
            const overheadPerUnit = overheadPerLb * avgLbsPerUnit;
            const freightPerUnit = freightPerLb * avgLbsPerUnit;

            // Update cost scaling display (per unit)
            document.getElementById('laborPerUnit').textContent = formatCurrencyDecimal(laborPerUnit);
            document.getElementById('overheadPerUnit').textContent = formatCurrencyDecimal(overheadPerUnit);
            document.getElementById('freightPerUnit').textContent = formatCurrencyDecimal(freightPerUnit);
            document.getElementById('avgUnitSize').textContent = avgUnitSize.toFixed(1) + ' oz';

            // Calculate and render per-size metrics
            const sizeMetrics = calculateSizeMetrics(laborPerLb, overheadPerLb, freightPerLb);
            renderMixTable(sizeMetrics);
            updateMixValidation();

            // Calculate monthly data using editable mix
            let totalRevenue = 0;
            let totalCost = 0;
            let totalGM = 0;

            const monthlyData = MONTHS.map((month, i) => {
                const monthLbs = annualLbs * month.seasonality;

                // Calculate mix denominator (sum of mix fractions)
                let mixDenom = mixFractions.reduce((sum, m) => sum + m, 0);
                if (mixDenom === 0) mixDenom = 1;

                // Calculate revenue and non-LOF cost
                let revenue = 0;
                let nonLOFCost = 0;

                PRODUCTS.forEach((p, idx) => {
                    const effectiveMix = mixFractions[idx];

                    const lbPerUnit = p.size / 16;
                    const unitLbs = (monthLbs / mixDenom) * effectiveMix;
                    const units = unitLbs / lbPerUnit;

                    revenue += units * p.transfer;
                    nonLOFCost += units * p.nonLOF;
                });

                const laborCost = monthLbs * laborPerLb;
                const overheadCost = monthLbs * overheadPerLb;
                const freightCost = monthLbs * freightPerLb;
                const totalMonthCost = nonLOFCost + laborCost + overheadCost + freightCost;
                const grossMargin = revenue - totalMonthCost;
                const gmPct = revenue > 0 ? grossMargin / revenue : 0;

                totalRevenue += revenue;
                totalCost += totalMonthCost;
                totalGM += grossMargin;

                return {
                    name: month.name,
                    lbs: monthLbs,
                    revenue,
                    cost: totalMonthCost,
                    gm: grossMargin,
                    gmPct
                };
            });

            // Update summary metrics
            document.getElementById('totalRevenue').textContent = formatCurrency(totalRevenue);
            document.getElementById('totalCost').textContent = formatCurrency(totalCost);
            document.getElementById('totalGM').textContent = formatCurrency(totalGM);

            const overallGMPct = totalRevenue > 0 ? totalGM / totalRevenue : 0;
            document.getElementById('gmPercent').textContent = formatPercent(overallGMPct);

            // Find best size for indicator
            let bestSize = null;
            let bestMargin = -Infinity;
            sizeMetrics.forEach(m => {
                if (m.mixPct > 0 && m.marginPerLb > bestMargin) {
                    bestMargin = m.marginPerLb;
                    bestSize = m.size;
                }
            });
            const bestSizeEl = document.getElementById('bestSizeDisplay');
            if (bestSizeEl) {
                bestSizeEl.textContent = bestSize ? `${bestSize}oz` : '-';
                bestSizeEl.className = 'value positive';
            }

            const meetsTargetEl = document.getElementById('meetsTarget');
            if (targetGM === 0) {
                meetsTargetEl.textContent = '-';
                meetsTargetEl.className = 'value';
            } else if (overallGMPct >= targetGM) {
                meetsTargetEl.textContent = 'YES';
                meetsTargetEl.className = 'value positive';
            } else {
                meetsTargetEl.textContent = 'NO';
                meetsTargetEl.className = 'value negative';
            }

            // Update monthly table (simplified - no variance column)
            const tbody = document.getElementById('monthlyTable');
            tbody.innerHTML = monthlyData.map((m, i) => `
                <tr>
                    <td>${m.name}</td>
                    <td>${m.lbs.toLocaleString('en-US', {maximumFractionDigits: 0})}</td>
                    <td>${formatCurrency(m.revenue)}</td>
                    <td>${formatCurrency(m.cost)}</td>
                    <td class="${m.gm >= 0 ? 'positive' : 'negative'}">${formatCurrency(m.gm)}</td>
                    <td class="${m.gmPct >= 0.2 ? 'positive' : ''}">${formatPercent(m.gmPct)}</td>
                </tr>
            `).join('');

            // Update totals row
            document.getElementById('monthlyTotals').innerHTML = `
                <tr style="font-weight: 600; border-top: 2px solid rgba(255,255,255,0.2);">
                    <td>TOTAL</td>
                    <td>${annualLbs.toLocaleString('en-US', {maximumFractionDigits: 0})}</td>
                    <td>${formatCurrency(totalRevenue)}</td>
                    <td>${formatCurrency(totalCost)}</td>
                    <td class="${totalGM >= 0 ? 'positive' : 'negative'}">${formatCurrency(totalGM)}</td>
                    <td>${formatPercent(overallGMPct)}</td>
                </tr>
            `;
        }

        // Group products by flavor for display
        function getProductsByFlavor() {
            const flavors = {};
            PRICING_PRODUCTS.forEach(p => {
                if (!flavors[p.flavor]) flavors[p.flavor] = [];
                flavors[p.flavor].push(p);
            });
            return flavors;
        }

        // Render product checkboxes for a channel
        function renderProductCheckboxes(channel) {
            const container = document.getElementById(`${channel}-checkboxes`);
            const flavors = getProductsByFlavor();
            let html = '';

            for (const [flavor, products] of Object.entries(flavors)) {
                html += `<div class="flavor-group">`;
                html += `<div class="flavor-group-header">${flavor}</div>`;
                html += `<div class="product-checkboxes">`;

                products.forEach(p => {
                    const isSelected = channelSelections[channel].has(p.id);
                    const label = `${p.size}oz ${p.type}`;
                    html += `
                        <label class="product-checkbox ${isSelected ? 'selected' : ''}">
                            <input type="checkbox"
                                   ${isSelected ? 'checked' : ''}
                                   onchange="toggleProduct('${channel}', '${p.id}', this)">
                            ${label}
                        </label>
                    `;
                });

                html += `</div></div>`;
            }

            container.innerHTML = html;
        }

        // Toggle product selection
        function toggleProduct(channel, productId, checkbox) {
            if (checkbox.checked) {
                channelSelections[channel].add(productId);
            } else {
                channelSelections[channel].delete(productId);
            }
            // Update the checkbox label styling
            checkbox.parentElement.classList.toggle('selected', checkbox.checked);
            recalculatePricing();
        }

        // Select all products for a channel
        function selectAllChannel(channel) {
            PRICING_PRODUCTS.forEach(p => channelSelections[channel].add(p.id));
            renderProductCheckboxes(channel);
            recalculatePricing();
        }

        // Clear all products for a channel
        function clearAllChannel(channel) {
            channelSelections[channel].clear();
            renderProductCheckboxes(channel);
            recalculatePricing();
        }

        // Select products by size for a channel
        function selectBySize(channel, size) {
            channelSelections[channel].clear();
            PRICING_PRODUCTS.forEach(p => {
                if (p.size === size) channelSelections[channel].add(p.id);
            });
            renderProductCheckboxes(channel);
            recalculatePricing();
        }

        // Transfer pricing calculation
        function recalculatePricing() {
            const safewayGM = parseFloat(document.getElementById('safewayGM').value) / 100;
            const cvsGM = parseFloat(document.getElementById('cvsGM').value) / 100;
            const distributorGM = parseFloat(document.getElementById('distributorGM').value) / 100;
            const mfgTargetGM = parseFloat(document.getElementById('mfgTargetGM').value) / 100;
            const costcoMarkup = parseFloat(document.getElementById('costcoMarkup').value) / 100;

            const safewayPerOz = parseFloat(document.getElementById('safewayPerOz').value);
            const cvsPerOz = parseFloat(document.getElementById('cvsPerOz').value);
            const costcoPerOz = parseFloat(document.getElementById('costcoPerOz').value);

            // Costco pricing (only selected products)
            let costcoHTML = '';
            const costcoProducts = PRICING_PRODUCTS.filter(p => channelSelections.costco.has(p.id));

            if (costcoProducts.length === 0) {
                costcoHTML = '<div style="padding: 20px; color: #888; text-align: center;">No products selected. Use checkboxes above to add products.</div>';
            } else {
                costcoProducts.forEach(p => {
                    const targetSRP = Math.ceil(p.size * costcoPerOz * 100) / 100;
                    const maxMfgPrice = targetSRP / (1 + costcoMarkup);
                    const minPriceForGM = p.cogs / (1 - mfgTargetGM);
                    const suggestedTransfer = Math.min(maxMfgPrice, minPriceForGM);

                    let flag, flagClass;
                    if (p.cogs > maxMfgPrice) {
                        flag = 'SRP too low';
                        flagClass = 'error';
                    } else if (suggestedTransfer < minPriceForGM) {
                        flag = 'Below target GM';
                        flagClass = 'warning';
                    } else {
                        flag = 'OK';
                        flagClass = 'ok';
                    }

                    costcoHTML += `
                        <div class="pricing-row">
                            <div>${p.name}</div>
                            <div>${formatCurrencyDecimal(p.cogs)}</div>
                            <div>${formatCurrencyDecimal(targetSRP)}</div>
                            <div style="color: #22c55e;">${formatCurrencyDecimal(suggestedTransfer)}</div>
                            <div><span class="flag ${flagClass}">${flag}</span></div>
                        </div>
                    `;
                });
            }
            document.getElementById('costco-products').innerHTML = costcoHTML;

            // Safeway pricing (only selected products)
            let safewayHTML = '';
            const safewayProducts = PRICING_PRODUCTS.filter(p => channelSelections.safeway.has(p.id));

            if (safewayProducts.length === 0) {
                safewayHTML = '<div style="padding: 20px; color: #888; text-align: center;">No products selected. Use checkboxes above to add products.</div>';
            } else {
                safewayProducts.forEach(p => {
                    const targetSRP = Math.ceil(p.size * safewayPerOz * 100) / 100;
                    const retailCost = targetSRP * (1 - safewayGM);
                    const maxTransfer = retailCost * (1 - distributorGM);
                    const minPriceForGM = p.cogs / (1 - mfgTargetGM);
                    const suggestedTransfer = Math.min(maxTransfer, minPriceForGM);

                    let flag, flagClass;
                    if (p.cogs > maxTransfer) {
                        flag = 'SRP too low';
                        flagClass = 'error';
                    } else if (suggestedTransfer < minPriceForGM) {
                        flag = 'Below target GM';
                        flagClass = 'warning';
                    } else {
                        flag = 'OK';
                        flagClass = 'ok';
                    }

                    safewayHTML += `
                        <div class="pricing-row">
                            <div>${p.name}</div>
                            <div>${formatCurrencyDecimal(p.cogs)}</div>
                            <div>${formatCurrencyDecimal(targetSRP)}</div>
                            <div style="color: #22c55e;">${formatCurrencyDecimal(suggestedTransfer)}</div>
                            <div><span class="flag ${flagClass}">${flag}</span></div>
                        </div>
                    `;
                });
            }
            document.getElementById('safeway-products').innerHTML = safewayHTML;

            // CVS pricing (only selected products)
            let cvsHTML = '';
            const cvsProducts = PRICING_PRODUCTS.filter(p => channelSelections.cvs.has(p.id));

            if (cvsProducts.length === 0) {
                cvsHTML = '<div style="padding: 20px; color: #888; text-align: center;">No products selected. Use checkboxes above to add products.</div>';
            } else {
                cvsProducts.forEach(p => {
                    const targetSRP = Math.ceil(p.size * cvsPerOz * 100) / 100;
                    const retailCost = targetSRP * (1 - cvsGM);
                    const maxTransfer = retailCost * (1 - distributorGM);
                    const minPriceForGM = p.cogs / (1 - mfgTargetGM);
                    const suggestedTransfer = Math.min(maxTransfer, minPriceForGM);

                    let flag, flagClass;
                    if (p.cogs > maxTransfer) {
                        flag = 'SRP too low';
                        flagClass = 'error';
                    } else if (suggestedTransfer < minPriceForGM) {
                        flag = 'Below target GM';
                        flagClass = 'warning';
                    } else {
                        flag = 'OK';
                        flagClass = 'ok';
                    }

                    cvsHTML += `
                        <div class="pricing-row">
                            <div>${p.name}</div>
                            <div>${formatCurrencyDecimal(p.cogs)}</div>
                            <div>${formatCurrencyDecimal(targetSRP)}</div>
                            <div style="color: #22c55e;">${formatCurrencyDecimal(suggestedTransfer)}</div>
                            <div><span class="flag ${flagClass}">${flag}</span></div>
                        </div>
                    `;
                });
            }
            document.getElementById('cvs-products').innerHTML = cvsHTML;
        }

        // Initialize product checkboxes
        function initProductSelectors() {
            renderProductCheckboxes('costco');
            renderProductCheckboxes('safeway');
            renderProductCheckboxes('cvs');
        }

        // Initialize on page load
        window.onload = function() {
            checkAuth();
        };
    </script>
</body>
</html>
